# ===============================
# ğŸ“¦ Install required libraries
# ===============================
!pip install -q gradio google-generativeai sentence-transformers faiss-cpu PyPDF2

# ===============================
# ğŸ“‚ Upload your `my_rag.py` file
# ===============================
from google.colab import files
uploaded = files.upload()  # Upload your my_rag.py here
# ===============================
# ğŸ§  Import your RAG system
# ===============================
from my_rag import RAGSysstem  # Make sure this matches the uploaded filename

# ===============================
# ğŸ” Enter your Gemini API Key
# ===============================
import getpass
API_KEY = getpass.getpass("AIzaSyDVxsY5RFOGkJYvgQ9e_QzG9rYePEYgLYw")

# âœ… Initialize RAG system
rag = RAGSysstem(api_key=API_KEY)

# ===============================
# ğŸ“˜ Gradio chatbot functions
# ===============================
import gradio as gr

def upload_pdf_gradio(file):
    if file is None:
        return "No file uploaded."

    success = rag.upload_pdf(file.name)
    return "âœ… File uploaded and processed." if success else "âŒ Failed to process file."

def ask_question_gradio(question):
    if not question.strip():
        return "Please enter a valid question."

    return rag.ask(question)

# ===============================
# ğŸ¨ Gradio UI
# ===============================
with gr.Blocks() as demo:
    gr.Markdown("# ğŸ“˜ PDF Q&A Chatbot with Gemini")

    with gr.Row():
        file_input = gr.File(label="ğŸ“ Upload PDF", file_types=[".pdf"])
        upload_btn = gr.Button("ğŸ“¤ Upload PDF")
    upload_output = gr.Textbox(label="Upload Status")
    upload_btn.click(upload_pdf_gradio, inputs=file_input, outputs=upload_output)

    gr.Markdown("---")

    question_box = gr.Textbox(label="â“ Ask a Question")
    answer_box = gr.Textbox(label="ğŸ’¬ Answer", lines=5)
    ask_btn = gr.Button("ğŸ” Ask")

    ask_btn.click(ask_question_gradio, inputs=question_box, outputs=answer_box)

# ===============================
# ğŸŒ Launch Gradio app
# ===============================
demo.launch(share=True)
